<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <title>SEDK - Dev Env</title>
</head>

<body>
  <h1>SEDK - Dev Env</h1>
  <div class="widget-container">
    <iframe id="widget-iframe" src="../widget/widget.html" frameborder="0"></iframe>
  </div>

  <div class="controls">
    <h2>Viewer Commands</h2>
    <input type="text" id="task-input" placeholder="Task description">
    <button onclick="emulateTask()">!task</button>
    <br>
    <button onclick="emulateStatusCommand('complete')">!status complete</button>
    <button onclick="emulateStatusCommand('pause')">!status pause</button>

    <h2>Moderator Commands</h2>
    <input type="text" id="username-input" placeholder="Username">
    <button onclick="emulateApprove()">!approve</button>
    <button onclick="emulateReject()">!reject</button>
    <button onclick="emulateDoneTask()">!donetask</button>
  </div>

  <script>
    const iframe = document.getElementById('widget-iframe');

    function emulateMessage(username, text, tags = {}) {
      const event = {
        listener: 'message',
        event: {
          data: {
            text: text,
            displayName: username,
            tags: tags
          }
        }
      };
      iframe.contentWindow.postMessage({
          type: 'event:received',
          detail: event
      }, '*');
    }

    function emulateTask() {
      const task = document.getElementById('task-input').value;
      emulateMessage('testuser', `!task ${task}`);
    }

    function emulateStatusCommand(status) {
      emulateMessage('testuser', `!status ${status}`);
    }

    function emulateApprove() {
      const username = document.getElementById('username-input').value;
      emulateMessage('moduser', `!approve ${username}`, { mod: true });
    }

    function emulateReject() {
      const username = document.getElementById('username-input').value;
      emulateMessage('moduser', `!reject ${username}`, { mod: true });
    }

    function emulateDoneTask() {
      const username = document.getElementById('username-input').value;
      emulateMessage('moduser', `!donetask ${username}`, { mod: true });
    }
  </script>
</body>

</html>